# Linux

![Image_1](https://github.com/Hedgehog0224/catkin_ws/blob/docs/Documentation/Images/Folder-3-8/003-8-01.png)

Как было ранее указано, весь программный код Образовательного Робота написан и работает при помощи фреймворка ROS. В свою очередь, фреймворк необходимо развернуть над операционной системой, т.к. ROS является мета-операционной ОС. Для выполнения этого требования существуют различные дистрибутивы ROS, предназначенные для установки поверх различных ОС - будь то Windows, или один из дистрибутивов Linux.\
В образовательном роботе применяется ROS Noetic. Существует два варианта, на какие ОС его можно установить:
1. Стабильный. Ubuntu, Debian;
2. Экспериментальный. Windows 10, Arch Linux.

Для стабильной и корректной работы ROS в  образовательном роботе применяется ОС `%installname%`.


![Image_2](https://github.com/Hedgehog0224/catkin_ws/blob/docs/Documentation/Images/Folder-3-8/003-8-02.png)

Информация, содержащаяся в этой главе, даст представление о:
- Что такое система Linux;
- Работе с командной строкой;
    * перемещение по файловой системе;
    * создание, редактирование и удаление файлов;
    * установка программ, пакетов, их обновление;
- Работе с SSH.


## Что такое система Linux
Чаще всего, под Линуксом подразумевается операционная система (дистрибутив) на базе ядра Linux, утилит и программ GNU. Наиболее популярными являются *Linux Mint*, *Ubuntu*, *Debian*,, *Fedora*, *ArchLinux*, *CentOS*, и прочее.\

1. Linux open-source
Так как бесплатен сам Linux, в нем есть множество инструментов, построенных по принципу открытого ПО - мало того, что вам не надо платить за программу, так вы еще можете самостоятельно внести в нее изменения. Этим объясняется прозрачность устанавливаемых программ - в официальные репозитории вредоносное ПО не пройдет.

2. Linux безопаснее
Linux своими корнями уходит еще в доисторические UNIX-системы - и с тех пор многие принципы остались теми же. Так как весь код является низкоуровневым (не зависит от каких-либо дополнительных библиотек), взломать устройства будет трудно. Да и число пользователей Linux пока слишком мало, чтобы хакеры обратили на него внимание как на платформу для атаки.

3. Большинство дистрибутивов бесплатно
По сути, решающий фактор для организаций - почти все дистрибутивы бесплатно распространяются даже для коммерческого использования. Их не надо активировать - достаточно скачать и установить.

4. Linux быстрее
Да, это так. Операционные системы на базе ядра Linux действительно выигрывают в плане производительности перед Windows. Именно поэтому веб-сервера чаще всего оснащены именно этой системой.\
Конечно, далеко не каждый дистрибутив может похвастаться производительностью. К примеру, всемирно известная Ubuntu без настройки работать будет гораздо хуже, чем тот же самый Windows 7. Зато есть Xubuntu и Lubuntu, которые никогда вас не подведут.

5. Linux лучше настраивается
Windows как таковой не дает особой свободы действий, взять хотя бы предустановленные инструменты изменения внешнего вида - они мало чем могут помочь. А вот Linux!\
Смогли бы вы сделать такое в Windows? Может быть, с использованием сторонних программ - да, но это дало бы значительный ущерб вашей оперативной памяти. А представленный выше вид работает на совсем неприметном устройстве - 1 Гб RAM + Pentium 4. Не так уж и много, правда ли?

6. Выбирай на свой вкус!
Вы - дизайнер? Писатель? Художник? Переводчик? Тогда для вас наверняка уже готов дистрибутив, который содержит все готовые для работы программы!

Если в Windows вам приходилось все скачивать (да еще и с малоизвестных сайтов, рискуя словить вирус!), то на Linux основано множество дистрибутивов, которые уже настроены под определенные нужды.

К примеру, для небольшой (или большой) студии подойдет Ubuntu Studio, для переводчика - TuxTrans, для художника - Fedora Design Suite, для музыканта - KXStudio.

7. Стабильность
Если Windows требует множества обновлений, да и "засоряется" каждые полгода, в Linux такого не будет. Здесь нету реестра в привычном смысле этого слова, а все установленные пакеты и программы легко контролируются. Так что прощай, частая переустановка!

8. Linux мало весит
Сравните Ubuntu или Xubuntu (1,8 Гб и 1,3 Гб соответственно) с 5 Гб Windows 7. При этом набор программ Linux не только не уступает продукту Microsoft, но и наоборот, превосходит его! То же самое относится к программам - они весят значительно меньше.

9. Отзывчивое сообщество
Linux - это не Windows, где вас оставили наедине со своей проблемой. Во-первых, есть официальное англоязычное сообщество. Если же вы плохо знаете английский язык, ничего страшного - есть linux.org.ru, linuxforum.tech, forum.ubuntu.ru.

10. Обучение
Последнее по порядку, но первое по значимости! Обучение! В интернете полно обучающих курсов по Linux, есть много и живых курсов в разных ВУЗах и академиях, курсы есть платные и бесплатные. И вот некоторые из них:
- __https://www.youtube.com/playlist?list=PL874KddjzYd8d_A1mmUwxZ63MtJaSBXE1__;
- __https://www.specialist.ru/product/linux-courses__;
- __https://stepik.org/course/73/syllabus__;
- __https://linuxtrainingcenter.com/curses/__;

*Управление пакетами?*


__https://habr.com/ru/companies/timeweb/articles/668344/__
__https://habr.com/ru/articles/716394/__


## Работа с командной строкой
Не смотря на то, что у Linux есть богатое разнообразие графических интерфейсов (причём, часто даже более красивых, чем стандартный Windows), позволяющих работать с комфортом, существует очень мощный инструмент без графики - командная строка. Для программистов, разработчиков робототехники, операторов роботов и инженеров-эксплуатационщиков командная строка - один из основных инструментов работы.

### Горячие клавиши:
- `Ctrl + Clt + Tab` - вызов терминала;
- `Tab` - автодополнение. Если при наборе начала команды или пути нажать Tab, то при наличии команды или пути, оболочка её дополнит. Если доступно несколько вариантов, необходимо нажать Tab повторно, перебирая их. При достижении последнего, перебор начнётся с начала;
- `Стрелка вверх` - предыдущая команда в истории;
- `Стрелка вниз` - следующая команда в истории;
- `Ctrl + Alt + C` - скопировать выделенный фрагмент из терминала в буфер обмена (аналог `Ctrl + C`);
- `Ctrl + Alt + V` - скопировать в терминал из буфера обмена (аналог `Ctrl + V`);
- `Ctrl + C` - остановить выполняющуюся программу;
- `Ctrl + D` - завершить текущий сеанс связи.

**Абстрактный путь** - полный путь от главной (корневой) директории "`/`": `/home/user/Documents/Laboratory_work`.\
**Относительный путь** - путь от текущей директории: `/Documents/Laboratory_work`.

### Специальные символы:
- `.` - текущая директория;
- `..` - директория на уровень выше;
- `~` - домашняя директория;
- `*` - любое количество любых символов;
- `?` - ровно один любой символ.

### Команды терминала:
1. `ls`

Команда образована от List (список). Используется для вывода списка файлов в текущей директории. С добавлением аргумента (пути), выводит список файлов в заданной путём директории.\
Например, необходимо вывести список файлов в директории `/home/rosuser/`. Для этого нужно выполнить:

`ls /home/rosuser/`

2. `cd`

Команда образована от Change Directory (сменить директорию). Используется для перехода по дереву директорий (перехода в другую папку).\
Например, необходимо перейти в директорию `/home/rosuser/.local`. Для этого нужно выполнить:

`cd /home/rosuser/.local`

3. `mkdir`

Команда образована от make directory (создать директорию). Создает пустую директорию в той директории в которой вы сейчас находитесь.\
Например, необходимо создать директорию `ros_projects` и после перейти в неё. Для этого нужно выполнить:

`mkdir ros_projects`

Для перехода:

`cd ros_projects`.

4. `touch`

Команда предназначена для создания пустого файла.\
Например, необходимо создать пустой файл `robot.dat`. Для этого нужно выполнить::

`touch robot.dat`

5. `mv`

Команда образована от Move (переместить). Используется для перемещения (или переименования) файлов и директорий.\
Например, необходимо переместить только что созданный файл `robot.dat` из директории `/home/rosuser/ros_projects` в директорию `/home/rosuser/`. Для этого нужно выполнить:

`mv /home/rosuser/ros_projects/robot.dat /home/rosuser/robot.dat`

6. `cp`

Команда образована от Copy (скопировать). Создает копию файла или директории.\
Например, необходимо скопировать файл `robot.dat` в файл `robot.dat.bak`. Для этого нужно выполнить:

`cp robot.dat robot.dat.bak`

Например, необходимо скопировать директорию `ros_projects` в `ros_projects_1`. Для этого, после команды добавить параметр `-r`:

`cp -r /home/rosuser/ros_projects /home/rosuser/ros_projects_1`

7. `rm`

Команда образована от remove (удалить). Служит для удаления файлов.\
Например, необходимо удалить файл `robot.dat`. Для этого нужно выполнить:

`rm robot.dat`


8. `sudo`

Команда образована от Substitute User & DO (подменить пользователя и выполнить). Используется для выполнения других команд от имени суперпользователя, но пользоваться ей нужно аккуратно, так как существует риск повреждения системы.

Например, необходимо создать копию создать копию файла в "системной" директории `/etc`. При попытке выполнить команду, выводится предупреждение `Permission denied`:

`cp /etc/X11/xorg.conf /etc/X11/xorg.conf.bak`

Чтобы выполнить копию файла в "системной" директории, нужно выполнить от имени суперпользователя:

`sudo cp /etc/X11/xorg.conf /etc/X11/xorg.conf.bak`

9. `find`

Команда предназначена для поиска файлов, как минимум,\
Например, необходимо найдти в текущей директории все файлы (и директории), имя которых начинается на `robot`, и заканчивается `.xml` (это могут быть файлы `robot-rviz.xml, robot1.xml, robot.odt, robot-linux.xml`). Для этого нужно выполнить:

`find . -name "robot*.dat"`

Символ точки после команды означает, что поиск производится в текущей директории (и во всех директориях внутри текущей). После аргумента `-name` в кавычках записывается имя файла или маска (шаблон), по которой производится поиск. Символ звездочка в маске означает, что вместо звездочки могут быть любые символы.


10. `cat`

Команда образована от Сatenate (связывать). Используется для вывода содержимого указанного файла в указанный источник, например на экран или в другой файл.\
Например, необходимо просмотреть содержимое файла `/var/log/ros.log`. Для этого нужно выполнить:

`cat /var/log/ros.log`


11. `nano`

Команда запускает консольный текстовый редактор. При отсутствии графического интерфейса один из немногочисленных способов редактировать текстовый файл.\
Например, необходимо создать или отредактировать существующий файл `hostname`. Для этого нужно выполнить:

`nano /etc/hostname`

Откроется текстовый редактор. После, необходимо внести изменения в файл. Для сохранения изменений и выхода применяется последовательность из сочетания клавиш `Ctrl+x` и `y`. Для выхода без сохранения изменений необходимо ввести сочетание `Ctrl+n`.


12. `|`

Команда (она же конвейер перенаправления вывода) предназначена для подачи другой команды на вход после вывода первой.\
Например, если ввести команду ls в директории с большим количеством файлов, весь список будет выведен на в терминал. Для поэкранного вывода применяется команда `more` которая остановит вывод списка файлов при достижении края экрана:

`ls /usr/bin | more`


13. `ssh`

**SSH** (Secure Shell - безопасная оболочка) - сетевой протокол, предоставляющий безопасный способ доступа от одного компьютера к другому через незащищённую сеть. Протокол беспечивает надежную аутентификацию паролей и аутентификацию открытых ключей , а также зашифрованную передачу данных между двумя компьютерами, подключенными через открытую сеть, такую ​​как Интернет.
Команда `ssh` позволяет дистанционно подключиться к другой машине и управлять ею через терминал. Все команды и программы введенные в рамках сеанса ssh будут выполнятся на удаленном компьютере или роботе, а результат их выполнения будет выводиться на ваш экран. 

Например, необходимо подключится к вашему роботу №35 нужно набрать в терминале `ssh (username)@(сетевой адрес робота\ip адрес робота)`. Для этого нужно выполнить:

`ssh pi@turtlebro35.local`

или

`ssh pi@192.168.0.12`


14. `scp`

Команда представляет из себя аналог команды `cp`, но позволяет копировать файлы с одного компьютера на другой по сети.\
Синтаксис команды достаточно непростой - `scp user1@host1:file user2@host2:file`, но иногда команда незаменима в плане скорости переноса файлов (нет необходимости настраивать ftp или другой протокол).\
Например, необходимо перенести файл `robot.dat` из своего локального каталога на удаленного робота. Для этого нужно выполнить:

`scp user@ubuntu-pc1:/home/rosuser/robot.dat pi@turtlebro35.local:/home/pi/robot.dat`


15. `grep`

Команда образована от global regular expression print (печать глобального регулярного выражения). Является одной из самых востребованных команд в терминале Linux. Она сортирует и фильтрует текст на основе сложных правил.\
Утилита `grep` решает множество задач, в основном она используется для поиска строк, соответствующих строке в тексте или содержимому файлов. Также она может находить по шаблону или регулярным выражениям. Команда в считанные секунды найдёт файл в с нужной строчкой, текст в файле или отфильтрует из вывода только пару нужных строк.

Синтаксис: `grep [опции] шаблон [имя файла...]`

или: `команда | grep [опции] шаблон`

Например, необходимо отфильтровать вывод команды `find` и найти какой-то специфический файл. Для этого нужно выполнить:

`find /home/user/ -name "data" | grep .txt`

Вывод такой составной команды будет путь к файлу `data.txt` находящемуся в директории `/home/user/`.


16. `apt` или `apt-get`

Программа для установки, обновления и удаления программных пакетов. По сути - менеджер пакетов.\
Например, необходимо установить консольный файловый менеджер `Midnight Commander`. Для этого нужно выполнить:

`sudo apt install mc`

Если apt недоступен, необходимо использовать `apt-get`:

`sudo apt-get install mc`


### Материалы:
- _http://learn.voltbro.ru/free/ros-intro/lesson1-linux-intro/about_linux.html_;
- _https://docs.altlinux.org/ru-RU/archive/2.4/html-single/master/alt-docs-extras-linuxcovice/index.html_;




## SSH

**SSH** — защищенный протокол для удаленного доступа к компьютерам. Через SSH можно выполнять операции в командной строке компьютера, который физически находится в другом месте.

Иными словами, SSH — это дистанционная командная строка. Визуально вы работаете на своем компьютере, но в реальности — на другом.


### Что значит «протокол»?
**Протокол** — это набор соглашений, правил, по которым разные программы могут обмениваться информацией. SSH — это набор правил, который известен и вашему компьютеру, и тому компьютеру к которому вы подключаетесь.

Пример: вы вводите команду удаления файла, и эта команда передается на другой компьютер и выполняется там. Ответ (или сообщение об ошибке) возвращается и показывается на вашем компьютере.


### Что значит «защищенный»?
Вся информация передается в зашифрованном виде. Подобно тому, как некоторые сайты работают по HTTPS, шифруя информацию. Например, ваш онлайн-банкинг обязательно должен работать по защищенному соединению. В таком случае даже если всю информацию перехватывает злоумышленник, он не сможет расшифровать её


### Зачем это нужно?
Не всегда есть возможность физически находиться у компьютера, с которым нужно работать. В случае с роботом, например, нам не будет удобно подключать к нему монитор и клавиатуру, каждый раз когда мы захотим его запрограммировать. Или если робот находится на удаленном полигоне вам нужен способ запускать команды на нем не выходя из своего дома.


### Как подключаться по SSH?
Для подключения к удаленной машине по SSH нужен клиент — специальная программа. В Unix-подобных системах (Linux, macOS) клиент обычно установлен в системе по умолчанию, и достаточно открыть терминал. В Windows ранних версий нужно скачать сторонний клиент, например, Putty. Но для WIndows 10, команда ssh также работает из командной строчки.

Для подключения нужно указать адрес сервера и, опционально, имя пользователя и порт. Вот как выглядит команда при использовании консольного клиента (в терминале):

`ssh username@remote_host -p port`

Например, для подключения к роботу `10.8.0.6` в аккаунт `pi` нужно ввести:

`ssh pi@10.8.0.6`

Если не указывать порт, то будет использован порт SSH по умолчанию — `22`. Используемый порт задается при настройке SSH-сервера, программы, которая запущена на удаленном компьютере и ожидает подключения извне.

В графическом клиенте вроде Putty нужно ввести ту же информацию в соответствующие поля:

![Image_3](https://github.com/Hedgehog0224/catkin_ws/blob/docs/Documentation/Images/Folder-3-8/003-8-03.png)


### Fingerprint
При первом подключении появится сообщение:
```
The authenticity of host '10.8.0.6 (10.8.0.6)' can't be established.
ECDSA key fingerprint is fd:fd:d4:f9:77:fe:73:84:e1:55:00:ad:d6 :6d:22:fe.
Are you sure you want to continue connecting (yes/no)? yes
```

Введите `yes` в первый раз.


Это нужно для повышения безопасности. При настройке SSH-сервера создается уникальная комбинация символов — fingerprint («отпечатки пальцев»). Ваш компьютер запоминает эту комбинацию и сверяет ее при каждом новом соединении. Если кто-то переустановит SSH-сервер, или всю операционную систему, или вообще заменит удаленный компьютер, сохранив его адрес, то при следующем соединении вы узнаете об этом, потому что изменится fingerprint.

Если fingerprint не меняется, то такое сообщение не будет появляться.


### Подключение по паролю
Простейший вариант — подключение по паролю. После ввода команды ssh система запросит пароль:

```
pi@10.8.0.6's password:
```

Пароль придется вводить каждый раз.


### Подключение по ключу, без пароля
Для удобного подключения по SSH (и многим другим сервисам) без ввода пароля можно использовать ключи.

Нужно создать пару ключей: **приватный** (закрытый) ключ и **публичный** (открытый) ключ. Приватный ключ нужно хранить и никогда никому не показывать. Публичный ключ можно показывать всем и распространять свободно.

Эти *ключи связаны друг с другом* таким образом, что зашифровав информацию одним ключом, расшифровать ее можно только другим. Например, если ваш друг зашифрует письмо вашим публичным ключом, то прочитать его сможете только вы, потому что для этого нужен ваш приватный ключ. И наоборот: если вы зашифруете что-то своим приватным ключом, то расшифровать его можно только вашим публичным ключом. Так как публичный ключ доступен всем, любой может расшифровать это сообщение. Но он может быть уверен, что сообщение пришло именно от вас. В этом заключается идея цифровой подписи.


### Генерация ключей
Создадим пару ключей:

`ssh-keygen`

Программа запустится и спросит, куда сохранять ключи:

```
Generating public/private rsa key pair.
Enter file in which to save the key (/home/demo/.ssh/id_rsa):
```

Нажмите Enter для сохранения в стандартное место — директорию .ssh/id_rsa в вашей домашней директории.

Программа запросит passphrase. Это вроде пароля для ключа. Можно просто нажать Enter и пропустить этот шаг. Или ввести passphrase — тогда его нужно будет вводить каждый раз, когда используется ключ.

```
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
```

Ключи созданы:
```
Your identification has been saved in /home/demo/.ssh/id_rsa.
Your public key has been saved in /home/demo/.ssh/id_rsa.pub.
The key fingerprint is:
8c:e9:7c:fa:bf:c4:e5:9c:c9:b8:60:1f:fe:1c:d3:8a root@here
The key's randomart image is:
+--[ RSA 2048]----+
|                 |
|                 |
|                 |
|       +         |
|      o S   .    |
|     o   . * +   |
|      o + = O .  |
|       + = = +   |
|      ....Eo+    |
+-----------------+
```

Теперь у вас есть два файла:

- `~/.ssh/id_rsa` — приватный ключ. Никогда никому и никуда не передавайте его!
- `~/.ssh/id_rsa.pub` — публичный ключ. Спокойно распространяйте его.

В Windows можно использовать ssh-gen в подсистеме Ubuntu for Windows или в командной строке Git for Windows. Или создавать ключи графической утилитой вроде PuTTYgen.


### Загрузка публичного ключа на робота
Нужно добавить публичный ключ на робота в файл ~/.ssh/authorized_keys. Самый простой способ — запустить на локальной машине команду для копирования ключа:

```
ssh-copy-id -i /home/<имя_пользователя>/.ssh/id_rsa.pub pi@<сетевое_имя_робота>
```

Другой способ — подключиться по паролю, открыть в редакторе файл `~/.ssh/authorized_keys` и добавить в конец текст из вашего файла `~/.ssh/id_rsa.pub`.

Теперь при подключении пароль запрашиваться не будет.