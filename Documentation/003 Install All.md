# Руководство по установке всего Программного Обеспечения

## 1. Установка ОС на Raspberry Pi
Существует специально созданная под МК Операционная Система Raspberry Pi OS (ранее называвшаяся Raspbian), созданная на базе дистрибутива Debian, которая была оптимизирована специально для микрокомпьютеров Raspberry Pi.\
В нашем случае устанавливается **Raspberry Pi OS Lite (64-bite)**.

_https://robotclass.ru/articles/raspberry-pi-os-install/_
_https://habr.com/ru/sandbox/174416/_

### 1.1 Установка Raspberry Pi Imager
Нельзя поставить какую-либо операционную систему на Raspberry при помощи загрузочного носителя (будь то флешка или microSD-карта).

Вместо этого применяется приложение Raspberry Pi Imager. Оно позволяет быстро и просто установить Raspberry Pi OS или иную Операционную Систему на карту microSD, готовую к использованию с вашим МК.

Приложение скачивается с официального сайта - _https://www.raspberrypi.com/software/_.

### 1.2 Работа в Установка Raspberry Pi Imager
После установки запускаете приложение. Для нажатия доступно три кнопки: **Выбрать устройство**, **Выбрать ОС** и **Выбрать Запоминающее Устройство**.\
Во-первых, необходимо **Выбрать устройство** - из предоставленного списка пункт, соответствующий модели вашего МК. В наборе применяется модель **Raspberry Pi 4B**.\
Во-вторых, необходимо **Выбрать ОС**, которую требуется установить. Для установки **Raspberry Pi OS Lite (64-bite)** выбираете *Raspberry Pi OS (Other) -> Raspberry Pi OS Lite (64-bite)*.\
В-третьих, из списка выбрать неободимый пункт (скорее всего, будет отображаться единственный пункт - вставленная в разъём компьютера microSD).\

Далее, необходимо нажать на кнопку **Далее**. В открывшимся окне нажать на кнопку **Изменить параметры**. Далее:
1. Выбрать раздел **Общее**. Вводите *Имя хоста*, задаёте *Имя пользователя* и *Пароль* (пароль требуется для подключения к МК и автоматически шифруется при последующем открытии приложения), *SSID* (название Wi-Fi, к которому подключается МК), *Пароль* (происходит то же, что и с предыдущим). Обязательно необходимо выбрать *Страну Wi-Fi* как **RU**. Можно настроить часовой пояс.
2. Выбрать раздел **Службы**, выбрать **Включить SSH** (настройка аутентификации по паролю в зависимости от пожеланий). Это необходимо для последующей работы с удалённого устройства.
3. Выбрать раздел **Параметры**. Настройка по усмотрению.

Для последующей установки необходимо сохранить параметры (нажав на кнопку **Сохранить**) и нажать на кнопку **Да**. Происходит запись образа на microSD. В противном случае, можно вернуться к изменению параметров (кнопка **Изменить параметры**), либо вернуть параметры по умолчанию (кнопка **Нет, очистить параметры**), либо стереть все существующие данные с microSD, либо вернуться к настройке параметров установщика, нажав на крестик в правом верхнем углу окна.\

Когда натсройка параметров завершена, необходимо смонтировать образ на запоминающее устройство. В финальном окне жмём кнопку **Да** и ждём завершения процедуры копирования.\

### 1.3 Установка ОС на МК
После записи образа на microSD необходимо вытащить её из порта компьютера и вставить в порт МК. Затем, подключаем Raspberry Pi к питанию. Необходимо дождаться готовности МК к работе - должен беспрерывно гореть красный и перестать мигать зелёный светодиоды.\


## 2. Начало работы с Raspberry Pi
### 2.1 Подключение к МК
Необходимо подключиться к МК через протокол SSH. Для этого в терминале следует ввести следующую команду:\

```
ssh <Имя пользователя>@<имя хоста>.local

```
После, требуется ввести пароль пользователя. Подключение установлено.

### 2.2 Настройка I2C-портов
Для дальнейшей корректной работы образовательного робота нужно провести настройку портов для передачи данных по протоколу I2C:\
1. Ввести команду ```sudo raspi-config```. В открытом окне выбрать третий пункт (**3 Interface Options**).
2. При помощи клавиш-стрелок выбрать **Select** , открывается подробные настройки интерфейса.
3. Выбрать пятый пункт (**I5 I2C**).
4. Выбрать **Select**, **Yes**, **OK**.
Итог - порты для корректной работы I2C запущены. Необходимо выйти из настроек, выбрав **Finish**.

_https://www.raspberrypi.com/documentation/computers/configuration.html_

### 2.3 Установка Docker
1. Перед установкой **Docker Engine** необходимо удалить все конфликтующие пакеты (для первой установки пункт пропустить). Для этого применить команду:
```
for pkg in docker.io docker-doc docker-compose podman-docker containerd runc; do sudo apt-get remove $pkg; done
```
2. Проще всего установить Docker при помощи apt репозитория. Для этого:
    - Настроить apt репозиторий Docker:
    ```
    # Add Docker's official GPG key:
    sudo apt-get update
    sudo apt-get install ca-certificates curl
    sudo install -m 0755 -d /etc/apt/keyrings
    sudo curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
    sudo chmod a+r /etc/apt/keyrings/docker.asc

    # Add the repository to Apt sources:
    echo \
        "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
        $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
    sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
    sudo apt-get update
    ```
    - Установить пакеты Docker. Для установки последней версии применяется команда:
    ```
    sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
    ```
    
    - Убедиться в правильности установки, запустив hello-образ:
    ```
    sudo docker run hello-world
    ```
    Эта команда загружает тестовое изображение и запускает его в контейнере. Когда контейнер запускается, он выводит сообщение с подтверждением и завершает работу.

_https://docs.docker.com/engine/install/debian/_

### 2.4 Скачивание образа и запуск
Для последующей работы с образовательным роботом необходимо скачать образ контейнера с ОС **Ubuntu** и фреймворком **ROS** на борту.\
Чтобы скачать образ, применяется команда:
```
sudo docker run -it --privileged hedgehog0624/rosimage:v4
```
После скачивания, образ запускается - можно приступать к работе.\

Сама механика запуска образа выглядит следующим образом:
1. **Docker** проверяет наличие образа контейнера на компьютере, в случает отсутствия оного скачивает с **DockerHUB**.
2. При каждом запуске, контейнер создаётся заново. Все ранее сохранённые файлы должны храниться в специально выделенном под это томе. Сам том храниться в директории **Raspberry Pi OS**.