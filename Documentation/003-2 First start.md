# Первый запуск

## 1. Подготовка к работе
Для начала работы с роботом (с установленными на него программами) необходимо запустить Docker-контейнер. В нём же необходимо запустить пакет ROS:
1. Запуск контейнера:
```sudo docker run -it --privileged hedgehog0624/rosimage:v4```
2. Запуск пакета:
```roslaunch robot_pkg robot.launch --screen```

## 2. Начало работы
Теперь можно приступить к работе. Ниже описываются основные алгоритмы для движения робота.
### 2.1 Алгоритмы для автоматического движения
Для автоматического движения обрабатываются данные с лидара и дальномера. Примечательно, что дальномер работает всегда (в любом режиме джойстика) и влияет на выбор направления движения.\
Поэтому, после запуска изначально работает только дальномер - при наличии перед ним препятствия, робот отъезжает на заданное расстояние и останавливается.\
Для автоматического управления необходимо получать данные с лидара - для этого следует нажать и удерживать кнопку **R2** джойстика. Робот стремиться отдалиться от препятствий на заданное в программе расстояние.
![Image_1](https://github.com/Hedgehog0224/catkin_ws/blob/docs/Documentation/Images/003-2-1.jpg)
### Изображение 1 - Наименование кнопок джойстика (003-2-1.jpg)
Если же кнопка не нажата, лидар не участвует в работе. Однако, можно отключить дальномер. Для этого необходимо нажать кнопку **???** джойстика.\

*Для изменения параметров движения необходимо править следующие строки:*
- В строке **58** (```if temp > 0.6:```) можно изменить значение расстояния, от каторого зависит работа лидара;
- В строке **71** (```new_data = data.ranges[0:int(len(data.ranges)*0.4)] + data.ranges[int(len(data.ranges)*0.6):int(len(data.ranges))]```) можно изменить значение угла сканирования;
![Image_2](https://github.com/Hedgehog0224/catkin_ws/blob/docs/Documentation/Images/003-2-2.png)
### Изображение 2 - Схема значений для изменения работы лидара (003-2-1.png)
- В строке **99** (```if dataFloat < 20.0:```) можно изменить значение расстояния, от каторого зависит работа дальномера.

### 2.2 Сообщения, выводимые при автоматическом движении
**Таблица 1 - Сообщения и их значения**
| № | Сообщение                                                         | Значение                                  |
|---|-------------------------------------------------------------------|-------------------------------------------|
| 1 | The mode in which the robot does not drive is selected: 0         | 0 кнопок нажато                           |
| 2 | This is the user mode: 3                                          | 2 кнопки нажато                           |
| 3 | No obstacles detected, the robot is in rest mode: <расстояние>    | R2 нажата и нет препятствий               |
| 4 | ERROR OF MATH                                                     | Ошибка: Неверное значение ШИМ для моторов |
| 5 | ERROR INCORRECT DATA                                              | Ошибка: Некорректные данные с джойстика   |

### 2.3 Алгоритмы для ручного управления
Режим ручного управления подразумевает под собой управление движением робота с джойстика. Для переключения в данный режим необходимо нажать и удерживать кнопку **L2**.\
Для управления направлением движения используются стики:
- **Left Stick/L3** - вращение вокруг своей оси;
- **Right Stick/R3** - выбор направления движения (всенаправленно).

*Для изменения параметров движения необходимо править следующие строки:*
- В строке **125** (```robotcl.JoySpeed = [data.x, data.y]```) можно инвертировать оси джойстика, добавив минусы перед **data.x**, или **data.y**, или перед обеими;
- В строке **103** (```JoyArr = robotcl.abcd.set_speed(robotcl.JoySpeed[0], robotcl.JoySpeed[1], turnOsSys=45, ModeOfAngles = 1, FuncOfAngel = [0, -robotcl.JoyAngle])```) можно изменить:
    * в переменных **robotcl.JoySpeed** значения (0 на 1, или 1 на 0) для замены осей системы координат;
    * значение параметра **turnOsSys** для изменения угла поворота системы координат (при значении **45** робот едет по направлению лидара; при значении **0** едет на 45 градусов правее относительно лидара; при значении **90** левее на 45 градусов левее относительно лидара);
    * значение параметра **ModeOfAngles** - при значении **0** робот лишается возможности вращения вокруг своей оси, при значении **1** получает возможность (существует также значение **2**, но его необходимол протестировать);
    * значения параметра **FuncOfAngel** для изменения скорости поворота (*более подробное описание будет выполнено в ближайшем будущем*).